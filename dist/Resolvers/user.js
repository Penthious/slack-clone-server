'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _auth=require('../auth'),_formatErrors=require('../formatErrors'),_formatErrors2=_interopRequireDefault(_formatErrors),_permissions=require('../permissions');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}exports.default={User:{teams:(a,b,{models:c,user:d})=>c.sequelize.query('SELECT * FROM teams as team JOIN members as member on team.id = member.team_id WHERE member.user_id = ?',{replacements:[d.id],model:c.Team,raw:!0})},Query:{getUser:_permissions.requiresAuth.createResolver((a,{userId:b},{models:c})=>c.User.findOne({where:{id:b}})),allUsers:_permissions.requiresAuth.createResolver((a,b,{models:c})=>c.User.findAll()),me:_permissions.requiresAuth.createResolver((a,b,{models:c,user:d})=>c.User.findOne({where:{id:d.id}}))},Mutation:{login:(a,{email:b,password:c},{models:d,SECRET:e,SECRET2:f})=>(0,_auth.tryLogin)(b,c,d,e,f),register:async(a,b,{models:c,SECRET:d,SECRET2:e})=>{try{const a=await c.User.create(b),[f,g]=await(0,_auth.createTokens)(a,d,b.password+e);return{ok:!0,user:a,token:f,refreshToken:g}}catch(a){return{ok:!1,errors:(0,_formatErrors2.default)(a,c)}}}}};